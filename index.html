<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RideBot ‚Äî Rate Your Ride (Snow Edition)</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel: rgba(255,255,255,0.08);
      --panel2: rgba(255,255,255,0.05);
      --border: rgba(255,255,255,0.14);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.65);
      --mono: ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --shadow: 0 20px 70px rgba(0,0,0,0.55);
    }

    html,body{
      height:100%;
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(900px 700px at 15% 5%, rgba(96,165,250,0.22), transparent 60%),
        radial-gradient(900px 700px at 85% 92%, rgba(167,139,250,0.18), transparent 55%),
        radial-gradient(700px 500px at 50% 50%, rgba(255,255,255,0.07), transparent 60%),
        var(--bg);
      display:grid;
      place-items:center;
      padding: 18px;
      box-sizing:border-box;
    }

    .app{
      width: min(560px, 100%);
      height: min(420px, 100%);
      border-radius: 22px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      box-shadow: var(--shadow);
      overflow: hidden;
      position: relative;
      display: grid;
      grid-template-rows: auto 1fr auto;
    }

    .topbar{
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.15);
    }
    .brand{display:flex;align-items:center;gap:10px;user-select:none;}
    .botIcon{
      width: 34px; height: 34px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.16);
      background:
        radial-gradient(14px 14px at 35% 35%, rgba(255,255,255,0.18), transparent 60%),
        linear-gradient(135deg, rgba(96,165,250,0.35), rgba(167,139,250,0.28));
      display:grid;place-items:center;
      font-weight: 900;letter-spacing: -0.5px;
    }
    .brandText{display:grid; gap:2px;}
    .brandText .name{font-weight: 800; font-size: 14px; line-height: 1;}
    .brandText .status{font-size: 11px; color: var(--muted); line-height: 1;}
    .pill{
      font-family: var(--mono);
      font-size: 11px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.80);
      user-select:none;
      white-space: nowrap;
    }

    .chat{
      padding: 14px 14px;
      overflow: auto;
      display:flex;
      flex-direction: column;
      gap: 10px;
    }

    .bubbleRow{display:flex;gap:10px;align-items:flex-end;}
    .bubbleRow.user{justify-content:flex-end;}
    .bubbleRow.bot{justify-content:flex-start;}

    .avatar{
      width: 26px; height: 26px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      display:grid;place-items:center;
      font-size: 12px;
      user-select:none;
      flex: 0 0 auto;
    }

    .bubble{
      max-width: 78%;
      border-radius: 16px;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.20);
      line-height: 1.35;
      font-size: 13px;
      position:relative;
      overflow:hidden;
    }

    .bubble.bot{
      background:
        radial-gradient(180px 70px at 20% 20%, rgba(96,165,250,0.14), transparent 60%),
        rgba(0,0,0,0.22);
    }
    .bubble.user{
      background:
        radial-gradient(180px 70px at 80% 20%, rgba(167,139,250,0.16), transparent 60%),
        rgba(0,0,0,0.22);
    }

    .meta{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,0.62);
      margin-top: 6px;
      user-select:none;
    }

    .composerWrap{
      border-top: 1px solid rgba(255,255,255,0.10);
      padding: 12px 12px;
      background: rgba(0,0,0,0.15);
      display:grid;
      gap: 10px;
    }

    .quickTitle{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      color: rgba(255,255,255,0.70);
      font-size: 11px;
      user-select:none;
    }

    .quickRow{
      display:flex;
      flex-direction: row-reverse; /* 5..1 visually */
      gap: 10px;
      justify-content: space-between;
      flex-wrap: nowrap;
    }

    .qr{
      flex: 1 1 0;
      min-width: 0;
      border-radius: 14px;
      padding: 10px 10px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.90);
      cursor:pointer;
      font-weight: 800;
      font-size: 12px;
      user-select:none;
      display:grid;
      place-items:center;
      gap: 4px;

      --tx: 0px; --ty: 0px;
      transform: translate(var(--tx), var(--ty));
      transition: transform 220ms cubic-bezier(.2,.9,.2,1.2), background 120ms ease, border-color 120ms ease;
      position: relative;
    }
    .qr:hover{ background: rgba(255,255,255,0.10); }
    .qr:active{ background: rgba(255,255,255,0.12); }

    .qr small{
      font-weight: 700;
      font-size: 10px;
      color: rgba(255,255,255,0.70);
      letter-spacing: 0.2px;
    }

    .qr.flee{
      border-color: rgba(255,255,255,0.22);
      background: rgba(255,255,255,0.08);
    }

    .actions{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap: wrap;
    }
    .btn{
      border-radius: 14px;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      cursor:pointer;
      font-weight: 800;
      transition: transform 120ms ease, background 120ms ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,0.10); }
    .btn:active{ transform: translateY(0) scale(0.99); }
    .btn.primary{
      border-color: rgba(96,165,250,0.35);
      background: rgba(96,165,250,0.14);
    }
    .btn.danger{
      border-color: rgba(248,113,113,0.35);
      background: rgba(248,113,113,0.14);
    }
    .btn.disabled{
      opacity: 0.55;
      cursor: not-allowed;
      transform: none !important;
    }

    .note{
      flex: 1 1 auto;
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,0.65);
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,0.22);
      border: 1px solid rgba(255,255,255,0.12);
      min-width: 180px;
    }

    /* ‚úÖ Snow overlay */
    .snow{
      position:absolute;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index: 50;
    }
    .flake{
      position:absolute;
      top:-40px;
      font-size: 16px;
      opacity: 0.95;
      filter: drop-shadow(0 12px 18px rgba(0,0,0,0.35));
      animation-name: fall;
      animation-timing-function: linear;
      animation-fill-mode: forwards;
      will-change: transform, opacity;
      user-select:none;
    }
    @keyframes fall{
      0%   { transform: translate3d(0,0,0) rotate(0deg); opacity: 0; }
      10%  { opacity: 1; }
      100% { transform: translate3d(var(--drift), 520px, 0) rotate(var(--spin)); opacity: 0; }
    }

    .typing{
      display:inline-flex;
      gap: 4px;
      align-items:center;
      margin-left: 6px;
    }
    .dot{
      width: 6px; height: 6px;
      border-radius: 999px;
      background: rgba(255,255,255,0.55);
      animation: bop 900ms ease-in-out infinite;
    }
    .dot:nth-child(2){ animation-delay: 120ms; }
    .dot:nth-child(3){ animation-delay: 240ms; }
    @keyframes bop{
      0%,100%{ transform: translateY(0); opacity:0.6;}
      50%{ transform: translateY(-4px); opacity:1;}
    }
  </style>
</head>

<body>
  <div class="app" id="app">
    <div class="topbar">
      <div class="brand">
        <div class="botIcon">RB</div>
        <div class="brandText">
          <div class="name">RideBot</div>
          <div class="status" id="statusLine">Online ‚Ä¢ calibrating your ‚Äútruth‚Äù</div>
        </div>
      </div>
      <div class="pill" id="pill">mode: CALIBRATION</div>
    </div>

    <div class="chat" id="chat">
      <div class="bubbleRow bot">
        <div class="avatar">ü§ñ</div>
        <div class="bubble bot">
          Hi! I‚Äôm RideBot. I can help you rate your ride.
          <div class="meta">We value your feedback. We also value cardio.</div>
        </div>
      </div>

      <div class="bubbleRow bot">
        <div class="avatar">ü§ñ</div>
        <div class="bubble bot">
          Calibration mode: make 4 attempts. Then you may submit your actual opinion.
          <div class="meta">Hover 1‚Äì3 to watch them develop independence.</div>
        </div>
      </div>
    </div>

    <div class="composerWrap">
      <div class="quickTitle">
        <span>Quick replies</span>
        <span style="font-family:var(--mono); opacity:0.9;" id="triesText">calibration: 0/4</span>
      </div>

      <div class="quickRow" id="quickRow">
        <button class="qr" type="button" data-rate="1">1 ‚≠ê<small>‚Äútragic‚Äù</small></button>
        <button class="qr" type="button" data-rate="2">2 ‚≠ê<small>‚Äúoof‚Äù</small></button>
        <button class="qr" type="button" data-rate="3">3 ‚≠ê<small>‚Äúmeh‚Äù</small></button>
        <button class="qr" type="button" data-rate="4">4 ‚≠ê<small>‚Äúnice‚Äù</small></button>
        <button class="qr" type="button" data-rate="5">5 ‚≠ê<small>‚Äúblessed‚Äù</small></button>
      </div>

      <div class="actions">
        <div class="note" id="note">Calibration: hover 1/2/3 if you crave suffering.</div>
        <button class="btn danger" id="resetBtn" type="button">Reset</button>
        <button class="btn primary disabled" id="submitBtn" type="button">Submit</button>
      </div>
    </div>

    <!-- ‚úÖ snow overlay container -->
    <div class="snow" id="snow" aria-hidden="true"></div>
  </div>

  <script>
    const app = document.getElementById('app');
    const chat = document.getElementById('chat');
    const quickRow = document.getElementById('quickRow');
    const triesText = document.getElementById('triesText');
    const note = document.getElementById('note');
    const resetBtn = document.getElementById('resetBtn');
    const submitBtn = document.getElementById('submitBtn');
    const statusLine = document.getElementById('statusLine');
    const snow = document.getElementById('snow');
    const pill = document.getElementById('pill');

    const CALIBRATION_TRIES = 4;

    let tries = 0;
    let unlocked = false;
    let submitted = false;

    let userPicked = null;
    let displayed = null;

    const fleeState = new Map([
      [1, {dx: 0, dy: 0, n: 0}],
      [2, {dx: 0, dy: 0, n: 0}],
      [3, {dx: 0, dy: 0, n: 0}],
    ]);

    let lastHoverQuipAt = 0;

    const sarcasmHover = [
      "Oh wow, you *almost* clicked it. Inspirational.",
      "Button says: ‚ÄòNot today.‚Äô Honestly? Fair.",
      "We detected honesty approaching. Executing emergency dodge.",
      "Bold of you to assume the UI is here to help you.",
      "The low rating has entered its ‚ú®avoidant era‚ú®."
    ];
    const sarcasmHoverEscalation = [
      "Still chasing it? I admire the commitment to suffering.",
      "At this point we should charge you for personal training.",
      "Your cursor has ambition. The button has boundaries.",
      "I‚Äôm logging this as ‚Äòuser enjoys puzzles‚Äô to protect everyone‚Äôs feelings.",
      "Congrats, you‚Äôve discovered: consequences."
    ];
    const sarcasmClickCal = [
      "Calibration click received. This will definitely matter. (It won‚Äôt.)",
      "Thank you. I will treasure this data in a sealed vault labeled ‚ÄòNo‚Äô.",
      "Excellent. I can now ignore you with greater accuracy.",
      "Love that for you. Bureaucracy is thriving.",
      "Attempt logged. Reality remains unchanged."
    ];
    const unlockQuips = [
      "‚úÖ Calibration complete. You may now submit your *actual* rating. Try not to be honest too loudly.",
      "Unlocked! Real feedback is now permitted. For legal reasons, this is a joke.",
      "Permission granted. Please remember: numbers have feelings."
    ];
    const postUnlockLines = {
      high: [
        "Amazing. A high rating. My favorite genre of truth.",
        "Thank you for your enthusiasm. The dashboard is delighted.",
        "Wonderful. Your positivity has been safely stored."
      ],
      mid: [
        "Noted. A medium rating. The most emotionally beige choice possible.",
        "Three stars. The Switzerland of opinions.",
        "A balanced take. The system dislikes nuance."
      ],
      low: [
        "A low rating? How brave. How inconvenient.",
        "I see. Criticism. In *this* economy.",
        "We will forward this to the Feelings Department for review."
      ]
    };
    const metaSnips = [
      "telemetry: stored",
      "model: passive-aggressive-v1",
      "confidence: 0.77 (unearned)",
      "routing: /feedback/feelings",
      "status: surprisingly petty"
    ];

    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
    function scrollToBottom(){ chat.scrollTop = chat.scrollHeight; }

    function addBubble(who, text, meta){
      const row = document.createElement('div');
      row.className = `bubbleRow ${who}`;

      const avatar = document.createElement('div');
      avatar.className = 'avatar';
      avatar.textContent = who === 'bot' ? 'ü§ñ' : 'üßë';

      const bubble = document.createElement('div');
      bubble.className = `bubble ${who}`;
      bubble.textContent = text;

      if (meta){
        const m = document.createElement('div');
        m.className = 'meta';
        m.textContent = meta;
        bubble.appendChild(m);
      }

      if (who === 'bot'){ row.appendChild(avatar); row.appendChild(bubble); }
      else { row.appendChild(bubble); row.appendChild(avatar); }

      chat.appendChild(row);
      scrollToBottom();
    }

    function addTyping(){
      statusLine.innerHTML = `Typing<span class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>`;
    }
    function clearTyping(){
      statusLine.textContent = unlocked ? "Online ‚Ä¢ accepting feedback (begrudgingly)" : "Online ‚Ä¢ calibrating your ‚Äòtruth‚Äô";
    }

    function computeDisplayed(clicked){
      // original gag: 1 becomes 3
      if (clicked === 1) return 3;
      return clicked;
    }

    function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

    // ‚úÖ Snow burst (replaces cheese)
    function snowBurst(intensity){
      const rect = app.getBoundingClientRect();
      const glyphs = ["‚ùÑÔ∏è","‚ùÖ","‚ùÜ","‚ú∂","‚ú≥Ô∏è"];
      for (let i = 0; i < intensity; i++){
        const flake = document.createElement('div');
        flake.className = 'flake';
        flake.textContent = glyphs[Math.floor(Math.random()*glyphs.length)];

        flake.style.left = `${Math.random() * (rect.width - 20)}px`;
        const size = 12 + Math.random()*14; // 12..26px
        flake.style.fontSize = `${size}px`;

        const drift = (-60 + Math.random()*120).toFixed(0) + "px"; // -60..60px
        const spin = (-180 + Math.random()*360).toFixed(0) + "deg";
        flake.style.setProperty('--drift', drift);
        flake.style.setProperty('--spin', spin);

        const dur = (900 + Math.random()*1100).toFixed(0) + "ms";
        flake.style.animationDuration = dur;

        const delay = (Math.random()*110).toFixed(0) + "ms";
        flake.style.animationDelay = delay;

        snow.appendChild(flake);
        flake.addEventListener('animationend', () => flake.remove());
      }
    }

    function fleeOnHover(btn, rate){
      if (unlocked || submitted) return;

      const st = fleeState.get(rate);
      if (!st) return;

      st.n += 1;

      const base = 8 + st.n * 9;
      const dist = clamp(base, 12, 78);

      const dxBias = (rate === 1) ? 1 : (rate === 3 ? -1 : (Math.random() < 0.5 ? 1 : -1));
      const dyBias = (Math.random() < 0.5 ? 1 : -1);

      const dx = st.dx + dxBias * (dist * (0.80 + Math.random()*0.55));
      const dy = st.dy + dyBias * (dist * (0.18 + Math.random()*0.35));

      st.dx = clamp(dx, -95, 95);
      st.dy = clamp(dy, -26, 26);

      btn.classList.add('flee');
      btn.style.setProperty('--tx', `${st.dx.toFixed(0)}px`);
      btn.style.setProperty('--ty', `${st.dy.toFixed(0)}px`);

      const now = Date.now();
      if (now - lastHoverQuipAt > 750){
        lastHoverQuipAt = now;
        const line = (st.n <= 2) ? pick(sarcasmHover) : pick(sarcasmHoverEscalation);
        addBubble('bot', line, pick(metaSnips));
      }

      if (Math.random() < 0.30) snowBurst(5);
      setTimeout(() => btn.classList.remove('flee'), 380);
    }

    function updateUI(){
      triesText.textContent = unlocked ? "unlocked ‚úÖ" : `calibration: ${tries}/${CALIBRATION_TRIES}`;
      pill.textContent = unlocked ? "mode: FEEDBACK" : "mode: CALIBRATION";

      if (unlocked && userPicked != null && !submitted) submitBtn.classList.remove('disabled');
      else submitBtn.classList.add('disabled');

      note.textContent = unlocked
        ? "Unlocked. Make your actual selection now. (We will pretend to listen.)"
        : "Calibration: hover 1‚Äì3 (if you enjoy chaos). Click any rating 4 times to unlock.";
    }

    function unlockIfReady(){
      if (!unlocked && tries >= CALIBRATION_TRIES){
        unlocked = true;
        addTyping();
        setTimeout(() => {
          clearTyping();
          addBubble('bot', pick(unlockQuips), "permissions: reluctantly_granted");
          snowBurst(18);
          updateUI();
        }, 520);
      }
    }

    function wireHoverHandlers(){
      quickRow.querySelectorAll('.qr').forEach(btn => {
        const rate = Number(btn.dataset.rate);
        btn.onmouseenter = null;
        if (rate <= 3){
          btn.onmouseenter = () => fleeOnHover(btn, rate);
        }
      });
    }

    quickRow.addEventListener('click', (e) => {
      const btn = e.target.closest('.qr');
      if (!btn || submitted) return;

      const rate = Number(btn.dataset.rate);
      addBubble('user', `I rate it ${rate}/5.`);

      if (!unlocked){
        tries++;
        addTyping();
        setTimeout(() => {
          clearTyping();
          addBubble('bot', `${pick(sarcasmClickCal)} (attempt ${tries}/${CALIBRATION_TRIES})`, pick(metaSnips));
          snowBurst(rate <= 3 ? 10 : 6);
          updateUI();
          unlockIfReady();
        }, 420);
        return;
      }

      userPicked = rate;
      displayed = computeDisplayed(rate);

      addTyping();
      setTimeout(() => {
        clearTyping();

        if (rate === 1){
          addBubble('bot',
            `Thank you! Interpreting ‚Äú1 ‚≠ê‚Äù as ‚Äú3 ‚≠ê‚Äù, because reality is optional.`,
            "model: blizzard-interpretation-v2 ‚Ä¢ confidence: 0.51"
          );
          snowBurst(20);
        } else {
          const band = (rate >= 4) ? "high" : (rate === 3 ? "mid" : "low");
          addBubble('bot',
            `${pick(postUnlockLines[band])} Recorded ${displayed}/5.`,
            pick(metaSnips)
          );
          if (Math.random() < 0.25) snowBurst(8);
        }

        note.textContent = `Selected: clicked ${userPicked}/5, displayed ${displayed}/5. Ready to submit.`;
        updateUI();
      }, 520);
    });

    resetBtn.addEventListener('click', () => {
      tries = 0;
      unlocked = false;
      submitted = false;
      userPicked = null;
      displayed = null;
      lastHoverQuipAt = 0;

      for (const st of fleeState.values()){
        st.dx = 0; st.dy = 0; st.n = 0;
      }
      quickRow.querySelectorAll('.qr').forEach(b => {
        b.style.setProperty('--tx', '0px');
        b.style.setProperty('--ty', '0px');
        b.classList.remove('flee');
      });

      chat.innerHTML = `
        <div class="bubbleRow bot">
          <div class="avatar">ü§ñ</div>
          <div class="bubble bot">
            Hi! I‚Äôm RideBot. I can help you rate your ride.
            <div class="meta">We value your feedback. We also value cardio.</div>
          </div>
        </div>
        <div class="bubbleRow bot">
          <div class="avatar">ü§ñ</div>
          <div class="bubble bot">
            Calibration mode: make 4 attempts. Then you may submit your actual opinion.
            <div class="meta">Hover 1‚Äì3 to watch them develop independence.</div>
          </div>
        </div>
      `;
      statusLine.textContent = "Online ‚Ä¢ calibrating your ‚Äòtruth‚Äô";
      wireHoverHandlers();
      updateUI();
      scrollToBottom();
    });

    submitBtn.addEventListener('click', () => {
      if (submitBtn.classList.contains('disabled')) return;
      if (submitted) return;

      submitted = true;
      addTyping();
      setTimeout(() => {
        clearTyping();

        console.log("SUBMIT", {
          clickedRating: userPicked,
          displayedRating: displayed,
          ts: new Date().toISOString(),
          widget: "RideBot Chat Rating (snow + hover-flee calibration)"
        });

        addBubble('bot', `‚úÖ Submitted! Final recorded rating: ${displayed}/5.`, "thanks. we will definitely ‚Äòcircle back‚Äô.");
        snowBurst(userPicked === 1 ? 26 : 14);

        note.textContent = `Submitted: clicked ${userPicked}/5, recorded ${displayed}/5.`;
        submitBtn.classList.add('disabled');
      }, 520);
    });

    wireHoverHandlers();
    updateUI();
    scrollToBottom();
  </script>
</body>
</html>
